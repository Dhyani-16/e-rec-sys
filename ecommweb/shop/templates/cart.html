{% extends 'base.html' %} 
{% load static %} 
{% block title %} Cart {% endblock %}


{% block css %}
<style>
    table th {
        width: auto !important;
    }
</style>

{% endblock %}

<body>
{% block body %}

<div class="container mt-5 " id="maincontainer">
    <h2 class="text-success">My cart</h2>


<div id="carttable" class="m-4">

<table class="table">
  <thead class="thead-dark">
    <tr>
      <th style="width: 5%;" scope="col">Item</th>
      <th style="width: 40%;" scope="col"> Name</th>
      <th style="width: 10%;" scope="col">Product Quantity</th>
      <th style="width: 20%;" scope="col">Price(per piece)</th>
      <th style="width: 20%;" scope="col">Total Price</th>
      
      <th style="width: 5%;" scope="col">Remove</th>
    </tr>
  </thead>
  <tbody id = "carttablebody">
    
  </tbody>
</table>

</div>

<div  style="margin-top: 50px;margin-left: 20px;">
    <h4>Delivery Details </h4>

    {% ifequal defaultAdd 1 %}

    <strong>Deliver to {{ profile.first_name }} {{profile.last_name|truncatechars:10}}</strong><br> Contact: {{ profile.contact_no }}<br> <span id="no1">{{ profile.address1|truncatechars:70 }}</span><br> {{profile.city}}
    <br> {{ profile.state }}<br>
    <a href="{% url 'Account' %}" style="color: blue;text-decoration: underline;">Change delivery details</a><br><br>
    
    {% else %}
    
    <strong>Deliver to {{ profile.first_name2 }} {{profile.last_name2|truncatechars:10}}</strong><br> Contact: {{ profile.contact_no2 }}<br> <span id="no1">{{ profile.address2|truncatechars:70 }}</span><br> {{profile.city2}}
    <br> {{ profile.state2 }}<br>
    <a href="{% url 'Account' %}" style="color: blue;text-decoration: underline;">Change delivery details</a><br><br>
    

    {% endifequal %}
                
</div>

</div>
{% endblock %}
</body>

<!-- {% for i in cart %}
i.Product_Detail
{% endfor %} -->
{% block js %}

<script>

//  get cart
if(localStorage.getItem('cart')==null){
    var cart = {};
}
else{
    cart = JSON.parse(localStorage.getItem('cart'));
    document.getElementById("cart").innerHTML = Object.keys(cart).length;

}


// remove product from cart
function removeItemFromCart(id) {

  delete cart[id];

  
  localStorage.setItem('cart', JSON.stringify(cart));

  window.location = "{% url 'Cart' %}"

  
}









// changing product quantity
function resetQuantity(flag,id){



  if(flag==0){

  let inText = parseInt($('#quantity'+id)[0].innerText);

      if(inText<=1){
        removeItemFromCart(id);

        
  $("#totalbillingamount")[0].innerText = parseInt($("#totalbillingamount")[0].innerText) - cart[id][2];



      }
      else{
        
      cart[id][0]--;
      $('#quantity'+id)[0].innerText = cart[id][0];
      $("#totalbillingamount")[0].innerText = parseInt($("#totalbillingamount")[0].innerText) - cart[id][2];


      }



  }else if(flag == 1){

    let inText = parseInt($('#quantity'+id)[0].innerText);
    cart[id][0]++;
    $('#quantity'+id)[0].innerText = cart[id][0];
    
    $("#totalbillingamount")[0].innerText = parseInt($("#totalbillingamount")[0].innerText) + cart[id][2];


  }


  $('#totalprice'+id)[0].innerText = cart[id][0] * cart[id][2];




  localStorage.setItem('cart', JSON.stringify(cart));
  

}








// get table body
let tbody = $('#carttablebody');

// counter used for number of unique products
let counter =1;
let total_bill = 0;
for(var x in cart){

    let quantity = cart[x][0];
    let name = cart[x][1];
    let price = cart[x][2];

  
    newrow = `<tr><th scope='row'>${counter}</th>
      <td>${name}</td>
      <td>
        <div class="row">
        <i class="badge badge-primary" style="font-size:1rem" onclick="resetQuantity(1,'${x}')">+</i>  
        
        
        <p id="quantity${x}"> ${quantity}</p>
        
        <i class="badge badge-primary" style="font-size:1rem" onclick="resetQuantity(0,'${x}')">-</i>
      </div></td>
      <td>${price}</td>
      <td id="totalprice${x}">${price*quantity}</td>
      <td>
        <i class="badge badge-danger" style="font-size:1rem" onclick="removeItemFromCart('${x}')">-</i></td>
    </tr>`;






    total_bill += quantity*price;
    $(newrow).appendTo(tbody);
    counter++;
}

// show total billing amount
billing_html = `<h3>Total Billing Amount : <b id="totalbillingamount" >${total_bill} </b></h3>`;
$(billing_html).appendTo($('#carttable'))



</script>
{% endblock %}
